import{$a as y,$b as Ft,Ja as vt,Ka as T,L as et,La as R,P as st,Pa as _t,Qb as xt,R as it,S as nt,Ta as Et,Va as ot,ab as V,ac as ct,bb as M,bc as bt,da as pt,e as tt,g as x,ib as L,jb as wt,ma as at,na as ft,rb as W,sa as gt,sb as St,ta as rt,tb as Dt,xa as G}from"./chunk-7GFGEI4V.js";import{a as Q,b as J,h as D}from"./chunk-7F6XFQYV.js";var Mt=["video"],kt=["canvas"],Ut=["resultsPanel"],k=(function(e){return e[e.ScannerQRCode_NONE=0]="ScannerQRCode_NONE",e[e.ScannerQRCode_PARTIAL=1]="ScannerQRCode_PARTIAL",e[e.ScannerQRCode_EAN2=2]="ScannerQRCode_EAN2",e[e.ScannerQRCode_EAN5=5]="ScannerQRCode_EAN5",e[e.ScannerQRCode_EAN8=8]="ScannerQRCode_EAN8",e[e.ScannerQRCode_UPCE=9]="ScannerQRCode_UPCE",e[e.ScannerQRCode_ISBN10=10]="ScannerQRCode_ISBN10",e[e.ScannerQRCode_UPCA=12]="ScannerQRCode_UPCA",e[e.ScannerQRCode_EAN13=13]="ScannerQRCode_EAN13",e[e.ScannerQRCode_ISBN13=14]="ScannerQRCode_ISBN13",e[e.ScannerQRCode_COMPOSITE=15]="ScannerQRCode_COMPOSITE",e[e.ScannerQRCode_I25=25]="ScannerQRCode_I25",e[e.ScannerQRCode_DATABAR=34]="ScannerQRCode_DATABAR",e[e.ScannerQRCode_DATABAR_EXP=35]="ScannerQRCode_DATABAR_EXP",e[e.ScannerQRCode_CODABAR=38]="ScannerQRCode_CODABAR",e[e.ScannerQRCode_CODE39=39]="ScannerQRCode_CODE39",e[e.ScannerQRCode_PDF417=57]="ScannerQRCode_PDF417",e[e.ScannerQRCode_QRCODE=64]="ScannerQRCode_QRCODE",e[e.ScannerQRCode_SQCODE=80]="ScannerQRCode_SQCODE",e[e.ScannerQRCode_CODE93=93]="ScannerQRCode_CODE93",e[e.ScannerQRCode_CODE128=128]="ScannerQRCode_CODE128",e[e.ScannerQRCode_SYMBOL=255]="ScannerQRCode_SYMBOL",e[e.ScannerQRCode_ADDON2=512]="ScannerQRCode_ADDON2",e[e.ScannerQRCode_ADDON5=1280]="ScannerQRCode_ADDON5",e[e.ScannerQRCode_ADDON=1792]="ScannerQRCode_ADDON",e})(k||{});var q="assets/wasm/index.js",B="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@1.7.6/wasm/index.js",Pt="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@latest/wasm/index.js",Lt="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",Tt={audio:!1,video:!0},ht={lineWidth:1,strokeStyle:"green",fillStyle:"#55f02880"},ut={font:"15px serif",strokeStyle:"#fff0",fillStyle:"#ff0000"},w={src:"",fps:30,vibrate:300,decode:"utf-8",unScan:!1,isBeep:!0,isMasked:!0,loadWasmUrl:"",symbolType:[k.ScannerQRCode_NONE],constraints:Tt,canvasStyles:[ht,ut]},Y=()=>"zbarWasm"in window,qt=(e,n,t)=>{if(n&&Object.keys(n[e]).length){for(let s in t){let i=JSON.parse(JSON.stringify(J(Q({},n[e]),{[s]:t[s]})));n[e]=n[e].hasOwnProperty(s)?n[e]:i}return n[e]}else return t},d=(e,n,t)=>{t?e.error(t):e.next(n),e.complete()},dt=(e=!1)=>{if(e===!1)return;let n=new Audio(Lt);n.oncanplaythrough=()=>{let t=n.play();t&&t.catch(s=>{s.name==="NotAllowedError"||s.name})}},Ot=(e,n,t,s)=>{let i,a,o=n.width,c=n.height,h=o/c,l=parseInt(getComputedStyle(n).width),r=parseInt(getComputedStyle(n).height),v=l/r;t.innerHTML="",h>v?(i=l/o,a=l/h/c):(a=r/c,i=r*h/o);for(let p=0;p<e.length;p++){let m=e[p],_=document.createElement("canvas"),S=_.getContext("2d",{willReadFrequently:!0}),E={},C=[],f=[],u=0,g=0,F=s.length===2&&s[1]?.font?.replace(/[^0-9]/g,"");F&&/[0-9]/g.test(F)&&(u=parseFloat(F),g=(i||1)*u,Number.isNaN(g)&&(g=u));let U=m.points;for(let A=0;A<U.length;A++){let j=U?.[A]?.x??0,H=U?.[A]?.y??0;E[`x${A+1}`]=j,E[`y${A+1}`]=H,C.push(j),f.push(H)}let $=Math.max(...C),b=Math.min(...C),X=Math.max(...f),O=Math.min(...f);_.setAttribute("class","qrcode-polygon"),h>v?(_.style.top=O*a+(r-l/h)*.5+"px",_.style.left=b*i+"px",_.width=($-b)*i,_.height=(X-O)*i):(_.style.top=O*a+"px",_.style.left=b*i+(l-r*h)*.5+"px",_.width=($-b)*a,_.height=(X-O)*a);for(let A in s[0])S[A]=s[0][A];let K=[];for(let A=0;A<C.length;A++)K.push((E[`x${A+1}`]-b)*a),K.push((E[`y${A+1}`]-O)*i);let P=K.slice(0);for(S.beginPath(),S.moveTo(P.shift(),P.shift());P.length;)S.lineTo(P.shift(),P.shift());if(S.closePath(),S.fill(),S.stroke(),u){let A=document.createElement("div");A.setAttribute("class","qrcode-tooltip-temp"),A.innerText=m.value,A.style.maxWidth=(o>window.innerWidth?window.innerWidth*.9:o)+"px",A.style.borderRadius=`clamp(1px, ${i*u-10}px, 3px)`,A.style.paddingBlock=`clamp(1px, ${i*u-10}px, 3px)`,A.style.paddingInline=`clamp(2.5px, ${i*u-6}px, 10px)`;let j=`<svg xmlns="http://www.w3.org/2000/svg" width="${g}" height="${g}" viewBox="0 0 512 512"><rect x="128" y="128" width="336" height="336" rx="57" ry="57"></rect><path d="M383.5,128l.5-24a56.16,56.16,0,0,0-56-56H112a64.19,64.19,0,0,0-64,64V328a56.16,56.16,0,0,0,56,56h24"></path></svg>`,H=new DOMParser().parseFromString(j,"application/xml"),Z=A.ownerDocument.importNode(H.documentElement,!0);Z.style.marginLeft=`clamp(1px, ${i*u-10}px, 3px)`,A.appendChild(Z),Z.addEventListener("click",()=>window.navigator.clipboard.writeText(m.value)),A.addEventListener("click",()=>window.navigator.clipboard.writeText(m.value));let I=document.createElement("div");I.setAttribute("class","qrcode-tooltip"),I.appendChild(A),a=r/c,i=r*h/o,I.style.fontSize=i*u+"px",I.style.top=O*a+"px",I.style.left=b*i+(l-r*h)*.5+"px",I.style.width=($-b)*a+"px",I.style.height=(X-O)*a+"px";let N=document.createElement("span");N.innerText=m.value,N.style.top=O*a+-20*a+"px",N.style.left=b*i+(l-r*h)*.5+"px";let Vt=s[1]?.font?.split(" ")?.[1];N.style.fontFamily=Vt,N.style.fontSize=i*u+"px",N.style.color=s?.[1]?.fillStyle,t?.appendChild(I),t?.appendChild(N)}t?.appendChild(_)}},Bt=(e,n,t)=>{let s=n.getContext("2d",{willReadFrequently:!0});for(let i=0;i<e.length;i++){let a=e[i],o={},c=[],h=[],l=0,v=t[1]?.font?.split(" ")?.[0]?.replace(/[^0-9]/g,"");v&&/[0-9]/g.test(v)&&(l=parseFloat(v));let p=a.points;for(let f=0;f<p.length;f++){let u=p?.[f]?.x??0,g=p?.[f]?.y??0;o[`x${f+1}`]=u,o[`y${f+1}`]=g,c.push(u),h.push(g)}let m=Math.min(...c),_=Math.min(...h),S=()=>{for(let g in t[0])s[g]=t[0][g];let f=[];for(let g=0;g<c.length;g++)f.push(o[`x${g+1}`]),f.push(o[`y${g+1}`]);let u=f.slice(0);for(s.beginPath(),s.moveTo(u.shift(),u.shift());u.length;)s.lineTo(u.shift(),u.shift());s.closePath(),s.fill(),s.stroke()},E=document.createElement("canvas"),C=()=>{let f=t[1]?.font?.split(" ")?.[1];E.height=n.height,E.width=n.width;let u=E.getContext("2d",{willReadFrequently:!0});u.font=l+"px "+f;for(let g in t[1])u[g]=t[1][g];Gt(u,a.value,m,_-5)};S(),C(),s.drawImage(E,0,0)}},jt=(e,n)=>{let t=n?.decode??w.decode,s=n?.canvasStyles?.length===2?n?.canvasStyles:[ht,ut],i=n?.isBeep??w.isBeep,a=n?.isMasked??w.isMasked,o=n?.unScan??w.unScan,c=n?.symbolType??w.symbolType;return new Promise((h,l)=>{let r=new FileReader;r.onload=()=>{let v={name:e.name,file:e,url:URL.createObjectURL(e)},p=new Image;p.setAttribute("crossOrigin","anonymous"),p.onload=()=>D(null,null,function*(){let m=document.createElement("canvas");m.width=p.naturalWidth||p.width,m.height=p.naturalHeight||p.height;let _=m.getContext("2d");_.drawImage(p,0,0,m.width,m.height);let S=_.getImageData(0,0,m.width,m.height);if(o)return h(Object.assign({},v,{data:[],canvas:m}));if(Y()){let E=yield zbarWasm.scanImageData(S);if(c?.some(f=>f.toString()!==k.ScannerQRCode_NONE.toString())&&(E=E.filter(f=>{let u=f.typeName.replace("ZBAR","ScannerQRCode");return c?.some(F=>F.toString()===k[u].toString())})),E?.length){E.forEach(F=>F.value=F.decode(t?.toLocaleLowerCase())),a&&Bt(E,m,s);let f=yield Rt(m),u=URL.createObjectURL(f);h(Object.assign({},v,{data:E,url:u,canvas:m,file:((F,U)=>new File([F],U,{lastModified:new Date().getTime(),type:F.type}))(f,v.name)})),dt(i)}else h(Object.assign({},v,{data:E,canvas:m}))}}),p.src=v.url},r.onerror=v=>l(v),r.readAsDataURL(e)})},Rt=(e,n)=>new Promise((t,s)=>e.toBlob(i=>t(i),n)),Ht=(e,n)=>new File([e],n,{lastModified:new Date().getTime(),type:e.type}),Qt=(e=[],n,t,s,i=new x)=>(Wt(e,t,s).then(a=>{Promise.all(Object.assign([],a).map(o=>jt(o,n))).then(o=>{d(i,o)}).catch(o=>d(i,null,o))}),i),Gt=(e,n,t,s)=>{let i=e.measureText("M").width*1.2,a=n.split(`
`);for(var o=0;o<a.length;++o)e.fillText(a[o],t,s),e.strokeText(a[o],t,s),s+=i},Wt=(e=[],n=100,t=100)=>{if(e.length&&(n<100||t<100)){let s=[];return new Promise((i,a)=>{for(let o of e){let c=new Image,h=new FileReader;h.onload=function(l){c.onload=function(){let r=document.createElement("canvas"),v=r.getContext("2d"),p=Math.round(c.width*(n/100)),m=Math.round(c.height*(n/100));r.width=p,r.height=m,v.drawImage(c,0,0,p,m),r.toBlob(_=>{let S=new File([_],o.name,{type:o.type});s.push(S),e.length===s.length&&i(s)},o.type,t/100)},c.src=l.target.result},h.onerror=l=>a(l),h.readAsDataURL(o)}})}else return Promise.resolve(e)},It=e=>{Object.assign([],e.childNodes).forEach(n=>e.removeChild(n))},Yt=e=>{e.getContext("2d",{willReadFrequently:!0}).clearRect(0,0,e.width,e.height)},lt=(e,n)=>{e.style.width=n.offsetWidth+"px",e.style.height=n.offsetHeight+"px"},Ct=(e=300)=>{e&&zt()&&window?.navigator?.vibrate(e)},zt=()=>{let e=navigator.userAgent||navigator.vendor||window.opera,n=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,t=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i,s=/^((?!chrome|android).)*safari/i;return!!(n.test(e)||t.test(e.substr(0,4)))&&!s.test(e)};var mt=(e="",n=new x,t)=>{let s=0,i=(a=!1)=>{let o=l=>{let r;try{let v=()=>{l&&zbarWasm.setModuleArgs({locateFile:(m,_)=>e||_+m}),setTimeout(()=>d(n,!0))},p=()=>{clearTimeout(r),Y()?v():r=setTimeout(()=>p())};setTimeout(()=>p()),setTimeout(()=>clearTimeout(r),3e3)}catch{clearTimeout(r)}},c=document.querySelectorAll(`script[src="${B}"]`),h=document.querySelectorAll(`script[src="${Pt}"]`);if(c.length||h.length)o(!1);else{let l=document.querySelectorAll(`script[src="${q}"]`);if(l.length===1)o(!1);else if(l.forEach(r=>r.remove()),t){let r=t.createElement("script");t.setAttribute(r,"src",a?B:q),t.setAttribute(r,"type","text/javascript"),t.setAttribute(r,"async",""),t.appendChild(document.head,r),r.onload=()=>o(!0),r.onerror=()=>{s<2?(document.head.removeChild(r),i(!0)):d(n,!1,"Could not load script "+a?B:q)},s+=1}else{let r=document.createElement("script");r.setAttribute("src",a?B:q),r.setAttribute("type","text/javascript"),r.setAttribute("async",""),document.head.appendChild(r),r.onload=()=>o(!0),r.onerror=()=>{s<2?(document.head.removeChild(r),i(!0)):d(n,!1,"Could not load script "+a?B:q)},s+=1}}};return i(),n},At=(()=>{class e{renderer;elementRef;video;canvas;resultsPanel;event=new ft;config=w;src=w.src;fps=w.fps;vibrate=w.vibrate;decode=w.decode;isBeep=w.isBeep;isMasked=w.isMasked;unScan=w.unScan;loadWasmUrl=w.loadWasmUrl;symbolType=w.symbolType;constraints=w.constraints;canvasStyles=[ht,ut];isStart=!1;isPause=!1;isLoading=!1;isTorch=!1;data=new tt([]);devices=new tt([]);deviceIndexActive=0;rAF_ID;dataForResize=[];ready=new x;STATUS={startON:()=>this.isStart=!0,pauseON:()=>this.isPause=!0,loadingON:()=>this.isLoading=!0,startOFF:()=>this.isStart=!1,pauseOFF:()=>this.isPause=!1,loadingOFF:()=>this.isLoading=!1,torchOFF:()=>this.isTorch=!1};constructor(t,s){this.renderer=t,this.elementRef=s}ngOnInit(){this.overrideConfig(),mt(this.loadWasmUrl,this.ready,this.renderer).subscribe(()=>{this.src&&this.loadImage(this.src),this.resize()})}start(t){let s=new x;return this.isStart?d(s,!1):this.safariWebRTC(s,t),s}stop(){this.STATUS.pauseOFF(),this.STATUS.startOFF(),this.STATUS.torchOFF(),this.STATUS.loadingOFF();let t=new x;try{clearTimeout(this.rAF_ID),this.video.nativeElement.srcObject.getTracks().forEach(s=>{s.stop(),d(t,!0)}),this.dataForResize=[],Yt(this.canvas.nativeElement),It(this.resultsPanel.nativeElement)}catch(s){d(t,!1,s)}return t}play(){let t=new x;return this.isPause?(this.video.nativeElement.play(),this.STATUS.pauseOFF(),this.requestAnimationFrame(),d(t,!0)):d(t,!1),t}pause(){let t=new x;return this.isStart?(clearTimeout(this.rAF_ID),this.video.nativeElement.pause(),this.STATUS.pauseON(),d(t,!0)):d(t,!1),t}playDevice(t,s=new x){let i=this.getConstraints(),a=this.isStart&&i?i.deviceId!==t:!0;switch(!0){case(t==="null"||t==="undefined"||!t):stop(),this.stop(),d(s,!1);break;case(t&&a):stop(),this.stop(),this.STATUS.loadingON(),this.deviceIndexActive=this.devices.value.findIndex(c=>c.deviceId===t);let o=J(Q({},this.constraints),{audio:!1,video:Q({deviceId:t},this.constraints.video)});navigator.mediaDevices.getUserMedia(o).then(c=>{this.video.nativeElement.srcObject=c,this.video.nativeElement.onloadedmetadata=()=>{this.video.nativeElement.play(),this.requestAnimationFrame(),d(s,!0),this.STATUS.startON(),this.STATUS.loadingOFF()}}).catch(c=>{this.eventEmit(!1),d(s,!1,c),this.STATUS.startOFF(),this.STATUS.loadingOFF()});break;default:d(s,!1),this.STATUS.loadingOFF();break}return s}loadImage(t){let s=new x;this.STATUS.startOFF(),this.STATUS.loadingON();let i=new Image;return i.setAttribute("crossOrigin","anonymous"),i.onload=()=>{Y()&&this.drawImage(i,a=>{d(s,a),this.STATUS.startOFF(),this.STATUS.loadingOFF()})},i.src=t,s}torcher(){let t=this.applyConstraints({advanced:[{torch:this.isTorch}]});return t.subscribe(()=>!1,()=>this.isTorch=!this.isTorch),t}applyConstraints(t,s=0){let i=new x;if(this.isStart){let a=this.video.nativeElement.srcObject;if(s!==null||s!==void 0||!Number.isNaN(s)){let o=a.getVideoTracks()[s];new window.ImageCapture(o).getPhotoCapabilities().then(()=>D(this,null,function*(){yield o.applyConstraints(t),lt(this.video.nativeElement,this.canvas.nativeElement),d(i,!0)})).catch(h=>{switch(h?.name){case"NotFoundError":case"DevicesNotFoundError":d(i,!1,"Required track is missing");break;case"NotReadableError":case"TrackStartError":d(i,!1,"Webcam or mic are already in use");break;case"OverconstrainedError":case"ConstraintNotSatisfiedError":d(i,!1,"Constraints can not be satisfied by avb. devices");break;case"NotAllowedError":case"PermissionDeniedError":d(i,!1,"Permission denied in browser");break;case"TypeError":d(i,!1,"Empty constraints object");break;default:d(i,!1,h);break}})}else d(i,!1,"Please check again deviceIndex")}else d(i,!1,"Please start the scanner");return i}getConstraints(t=0){return this.video.nativeElement.srcObject?.getVideoTracks()[t]?.getConstraints()}download(t=`ngx_scanner_qrcode_${Date.now()}.png`,s,i){let a=new x;return D(this,null,function*(){let o=yield Rt(this.canvas.nativeElement),c=Ht(o,t);Qt([c],this.config,s,i,a).subscribe(h=>{h.forEach(l=>{if(l?.data?.length){let r=document.createElement("a");r.href=l.url,r.download=l.name,r.click(),r.remove()}})})}),a}resize(){window.addEventListener("resize",()=>{Ot(this.dataForResize,this.canvas.nativeElement,this.resultsPanel.nativeElement,this.canvasStyles),lt(this.video.nativeElement,this.canvas.nativeElement)})}overrideConfig(){"src"in this.config&&(this.src=this.config.src),"fps"in this.config&&(this.fps=this.config.fps),"vibrate"in this.config&&(this.vibrate=this.config.vibrate),"decode"in this.config&&(this.decode=this.config.decode),"isBeep"in this.config&&(this.isBeep=this.config.isBeep),"isMasked"in this.config&&(this.isMasked=this.config.isMasked),"unScan"in this.config&&(this.unScan=this.config.unScan),"loadWasmUrl"in this.config&&(this.loadWasmUrl=this.config.loadWasmUrl),"symbolType"in this.config&&(this.symbolType=this.config.symbolType),"constraints"in this.config&&(this.constraints=qt("constraints",this.config,Tt)),"canvasStyles"in this.config&&this.config?.canvasStyles?.length===2&&(this.canvasStyles=this.config.canvasStyles)}safariWebRTC(t,s){this.STATUS.startOFF(),this.STATUS.loadingON(),navigator.mediaDevices.getUserMedia(this.constraints).then(i=>{i.getTracks().forEach(a=>a.stop()),this.loadAllDevices(t,s)}).catch(i=>{d(t,!1,i),this.STATUS.startOFF(),this.STATUS.loadingOFF()})}loadAllDevices(t,s){navigator.mediaDevices.enumerateDevices().then(i=>{let a=i.filter(o=>o.kind=="videoinput");this.devices.next(a),a?.length>0?(d(t,a),s?s(a):this.playDevice(a[0].deviceId)):(d(t,!1,"No camera detected."),this.STATUS.startOFF(),this.STATUS.loadingOFF())}).catch(i=>{d(t,!1,i),this.STATUS.startOFF(),this.STATUS.loadingOFF()})}drawImage(t,s=()=>{}){return D(this,null,function*(){let i=this.canvas.nativeElement,a=i.getContext("2d",{willReadFrequently:!0});t instanceof HTMLImageElement&&(i.width=t.naturalWidth,i.height=t.naturalHeight,t.style.visibility="",this.video.nativeElement.style.visibility="hidden",this.renderer.setStyle(this.elementRef.nativeElement,"width",i.width+"px"),this.renderer.setStyle(this.elementRef.nativeElement,"maxWidth","100%"),this.renderer.setStyle(this.elementRef.nativeElement,"display","inline-block")),t instanceof HTMLVideoElement&&(i.width=t.videoWidth,i.height=t.videoHeight,t.style.visibility="",this.canvas.nativeElement.style.visibility="hidden"),lt(this.video.nativeElement,i),a.clearRect(0,0,i.width,i.height),a.drawImage(t,0,0,i.width,i.height);let o=a.getImageData(0,0,i.width,i.height);if(this.unScan)return Promise.resolve();let c=yield zbarWasm.scanImageData(o);if(this.symbolType?.some(l=>l.toString()!==k.ScannerQRCode_NONE.toString())&&(c=c.filter(l=>{let r=l.typeName.replace("ZBAR","ScannerQRCode");return this.symbolType?.some(p=>p.toString()===k[r].toString())})),c?.length){c.forEach(r=>r.value=r.decode(this.decode?.toLocaleLowerCase())),this.isMasked&&Ot(c,Object.freeze(this.canvas.nativeElement),this.resultsPanel.nativeElement,this.canvasStyles);let l=()=>{this.eventEmit(c),this.dataForResize=c};t instanceof HTMLImageElement&&(s(!0),l(),Ct(this.vibrate),dt(this.isBeep)),t instanceof HTMLVideoElement&&(l(),Ct(this.vibrate),dt(this.isBeep))}else s(!1),It(this.resultsPanel.nativeElement),this.dataForResize=[]})}eventEmit(t=!1){t!==!1&&this.data.next(t||[]),t!==!1&&this.event.emit(t||[])}requestAnimationFrame(t=100){try{clearTimeout(this.rAF_ID),this.rAF_ID=setTimeout(()=>{this.video.nativeElement.readyState===this.video.nativeElement.HAVE_ENOUGH_DATA&&(t=0,Y()&&this.drawImage(this.video.nativeElement),this.isStart&&!this.isPause&&this.requestAnimationFrame(t))},t||this.fps)}catch{clearTimeout(this.rAF_ID)}}get isReady(){return this.ready}ngOnDestroy(){this.pause()}static \u0275fac=function(s){return new(s||e)(rt(gt),rt(pt))};static \u0275cmp=G({type:e,selectors:[["ngx-scanner-qrcode"]],viewQuery:function(s,i){if(s&1&&(y(Mt,5),y(kt,5),y(Ut,5)),s&2){let a;V(a=M())&&(i.video=a.first),V(a=M())&&(i.canvas=a.first),V(a=M())&&(i.resultsPanel=a.first)}},hostAttrs:[1,"ngx-scanner-qrcode"],inputs:{config:"config",src:"src",fps:"fps",vibrate:"vibrate",decode:"decode",isBeep:"isBeep",isMasked:"isMasked",unScan:"unScan",loadWasmUrl:"loadWasmUrl",symbolType:"symbolType",constraints:"constraints",canvasStyles:"canvasStyles"},outputs:{event:"event"},exportAs:["scanner"],decls:6,vars:0,consts:[["resultsPanel",""],["canvas",""],["video",""],[1,"origin-overlay"],[1,"origin-canvas"],["playsinline","",1,"origin-video"]],template:function(s,i){s&1&&_t(0,"div",3,0)(2,"canvas",4,1)(4,"video",5,2)},styles:[`.ngx-scanner-qrcode{display:block;position:relative}.origin-overlay{width:100%;position:absolute}.origin-overlay span{z-index:2;text-align:left;position:absolute}.origin-overlay .qrcode-polygon{z-index:1;position:absolute}.origin-canvas{width:100%;position:absolute}.origin-video{width:100%;background-color:#262626}.qrcode-tooltip{z-index:3;position:absolute}.qrcode-tooltip:hover .qrcode-tooltip-temp{display:block;position:absolute;cursor:copy}.qrcode-tooltip:hover .qrcode-tooltip-temp:active{color:#afafaf}.qrcode-tooltip .qrcode-tooltip-temp{bottom:0;left:50%;color:#fff;text-align:left;display:none;width:max-content;word-wrap:break-word;transform:translate(-50%);transform-style:preserve-3d;background-color:#000000d0;box-shadow:1px 1px 20px #000000e0}.qrcode-tooltip .qrcode-tooltip-temp svg{cursor:pointer}.qrcode-tooltip .qrcode-tooltip-temp svg rect{fill:none;stroke:#fff;stroke-linejoin:round;stroke-width:32px}.qrcode-tooltip .qrcode-tooltip-temp svg path{fill:none;stroke:#fff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px}.qrcode-tooltip .qrcode-tooltip-temp svg:active rect{stroke:#afafaf}.qrcode-tooltip .qrcode-tooltip-temp svg:active path{stroke:#afafaf}
`],encapsulation:2})}return e})();var z=class e{supabase;constructor(){this.supabase=Ft(ct.supabaseUrl,ct.supabaseKey)}insertMatch(n){return D(this,null,function*(){try{let{data:t,error:s}=yield this.supabase.from("matches").insert({opponent:n});s&&alert(s.message)}catch(t){alert(t)}})}listMatches(){return D(this,null,function*(){let{data:n,error:t}=yield this.supabase.from("matches_attended").select("*, users(full_name, email, teams(name)), matches(matchdatetime, opponent)").order("matches(matchdatetime)",{ascending:!0});if(t)throw alert(t.message),t;return n})}listMatchesTeam(){return D(this,null,function*(){let{data:n,error:t}=yield this.supabase.from("matches_attendedbyteam").select("*").order("order",{ascending:!0});if(t)throw alert(t.message),t;return n})}nextMatch(){let n=new Date;return n.setHours(0,0,0,0),this.supabase.from("matches").select("*").gte("matchdatetime",n.toISOString()).order("matchdatetime",{ascending:!0}).limit(1).single()}lastMatch(){let n=new Date;return n.setHours(23,59,59,0),this.supabase.from("matches").select("*").lte("matchdatetime",n.toISOString()).order("matchdatetime",{ascending:!1}).limit(1).single()}insertMatchAttendance(n,t){return D(this,null,function*(){let s={user_id:n,match_id:t},{data:i,error:a}=yield this.supabase.from("matches_attended").insert(s);return a})}getMatches(){return this.supabase.from("matches").select("*").order("matchdatetime",{ascending:!0})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=et({token:e,factory:e.\u0275fac,providedIn:"root"})};var $t=()=>({ideal:1920}),Xt=()=>({ideal:1080}),Kt=()=>({ideal:30}),Zt=(e,n,t)=>({auto:!0,facingMode:"environment",width:e,height:n,frameRate:t}),Jt=e=>({audio:!1,video:e}),yt=class e{imagePath="assets/images/logo-piacenza-young.jpeg";scannedData=null;lastMessage="";qrCurrentDevice=0;match_service=st(z);auth=st(bt);scanner;constructor(){mt("assets/wasm/ngx-scanner-qrcode.wasm").subscribe()}ngAfterViewInit(){this.scanner?.start();let n=this.scanner?.devices.value;n&&n.length>0&&this.scanner?.playDevice(n[0].deviceId)}testScan(){return D(this,null,function*(){yield this.auth.getCurrentUserId(),yield this.match_service.nextMatch();let n={user_id:"6113ba1f-5e4d-4edc-8949-f14596bb5751",match_id:"939a02b2-df75-47fd-a12d-2a56b0471d82"},t=yield this.match_service.insertMatchAttendance(n.user_id,n.match_id)})}onScan(n){return D(this,null,function*(){let t=n?.[0]?.value;this.scanner?.pause();try{let i=JSON.parse(t);this.scannedData=i}catch{alert("QR code NON VALIDO"),this.scannedData=null;return}let s=yield this.match_service.insertMatchAttendance(this.scannedData.user_id,this.scannedData.match_id);s?(alert("ERRORE REGISTRAZIONE"),this.lastMessage="Errore:"+s.message):(alert("Registrazione avvenuta con successo"),this.lastMessage="Registrazione avvenuta con successo"),this.scannedData=null,this.scanner?.play()})}switchCamera(){let n=this.scanner?.devices.value;if(!n||n.length===0)return;n.length<=this.qrCurrentDevice&&(this.qrCurrentDevice=0);let t=n[this.qrCurrentDevice];this.scanner?.playDevice(t.deviceId),n.length>this.qrCurrentDevice+1?this.qrCurrentDevice++:this.qrCurrentDevice=0}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=G({type:e,selectors:[["app-qr-reader"]],viewQuery:function(t,s){if(t&1&&y(At,5),t&2){let i;V(i=M())&&(s.scanner=i.first)}},decls:16,vars:11,consts:[["action","scanner"],[1,"container"],[2,"text-align","center","margin-top","20px"],[1,"d-flex","justify-content-center"],[3,"event","constraints"],[3,"click"]],template:function(t,s){if(t&1){let i=Et();T(0,"div",1)(1,"div",2)(2,"h2"),L(3,"Controllo Ingresso"),R()(),T(4,"div",3)(5,"ngx-scanner-qrcode",4,0),ot("event",function(o){return it(i),nt(s.onScan(o))}),R()(),T(7,"div",3)(8,"button",5),ot("click",function(){return it(i),nt(s.switchCamera())}),L(9,"Switch Camera"),R()(),T(10,"div",3)(11,"div")(12,"p"),L(13,"Ultima lettura:"),R()(),T(14,"p"),L(15),R()()()}t&2&&(at(5),vt("constraints",St(9,Jt,Dt(5,Zt,W(2,$t),W(3,Xt),W(4,Kt)))),at(10),wt(s.lastMessage))},dependencies:[xt,At],encapsulation:2})};export{z as a,yt as b};
