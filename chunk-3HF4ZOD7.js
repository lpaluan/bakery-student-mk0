import{Ab as B,Bb as j,Ib as lt,Ra as at,Sa as X,Za as L,db as ot,g as $,h as F,pb as K,qb as Z,ra as nt,rb as rt,sc as dt,ub as ct,zb as q}from"./chunk-SSRTGUR7.js";import{a as P,b as z,h as V}from"./chunk-FK42CRUA.js";var _t=["video"],wt=["canvas"],xt=["resultsPanel"],C=function(t){return t[t.ScannerQRCode_NONE=0]="ScannerQRCode_NONE",t[t.ScannerQRCode_PARTIAL=1]="ScannerQRCode_PARTIAL",t[t.ScannerQRCode_EAN2=2]="ScannerQRCode_EAN2",t[t.ScannerQRCode_EAN5=5]="ScannerQRCode_EAN5",t[t.ScannerQRCode_EAN8=8]="ScannerQRCode_EAN8",t[t.ScannerQRCode_UPCE=9]="ScannerQRCode_UPCE",t[t.ScannerQRCode_ISBN10=10]="ScannerQRCode_ISBN10",t[t.ScannerQRCode_UPCA=12]="ScannerQRCode_UPCA",t[t.ScannerQRCode_EAN13=13]="ScannerQRCode_EAN13",t[t.ScannerQRCode_ISBN13=14]="ScannerQRCode_ISBN13",t[t.ScannerQRCode_COMPOSITE=15]="ScannerQRCode_COMPOSITE",t[t.ScannerQRCode_I25=25]="ScannerQRCode_I25",t[t.ScannerQRCode_DATABAR=34]="ScannerQRCode_DATABAR",t[t.ScannerQRCode_DATABAR_EXP=35]="ScannerQRCode_DATABAR_EXP",t[t.ScannerQRCode_CODABAR=38]="ScannerQRCode_CODABAR",t[t.ScannerQRCode_CODE39=39]="ScannerQRCode_CODE39",t[t.ScannerQRCode_PDF417=57]="ScannerQRCode_PDF417",t[t.ScannerQRCode_QRCODE=64]="ScannerQRCode_QRCODE",t[t.ScannerQRCode_SQCODE=80]="ScannerQRCode_SQCODE",t[t.ScannerQRCode_CODE93=93]="ScannerQRCode_CODE93",t[t.ScannerQRCode_CODE128=128]="ScannerQRCode_CODE128",t[t.ScannerQRCode_SYMBOL=255]="ScannerQRCode_SYMBOL",t[t.ScannerQRCode_ADDON2=512]="ScannerQRCode_ADDON2",t[t.ScannerQRCode_ADDON5=1280]="ScannerQRCode_ADDON5",t[t.ScannerQRCode_ADDON=1792]="ScannerQRCode_ADDON",t}(C||{});var k="assets/wasm/index.js",M="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@1.7.6/wasm/index.js",Ft="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@latest/wasm/index.js",St="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",pt={audio:!1,video:!0},et={lineWidth:1,strokeStyle:"green",fillStyle:"#55f02880"},st={font:"15px serif",strokeStyle:"#fff0",fillStyle:"#ff0000"},w={src:"",fps:30,vibrate:300,decode:"utf-8",unScan:!1,isBeep:!0,isMasked:!0,loadWasmUrl:"",symbolType:[C.ScannerQRCode_NONE],constraints:pt,canvasStyles:[et,st]},H=()=>"zbarWasm"in window,Dt=(t,a,e)=>{if(a&&Object.keys(a[t]).length){for(let i in e){let s=JSON.parse(JSON.stringify(z(P({},a[t]),{[i]:e[i]})));a[t]=a[t].hasOwnProperty(i)?a[t]:s}return a[t]}else return e},d=(t,a,e)=>{e?t.error(e):t.next(a),t.complete()},tt=(t=!1)=>{if(t===!1)return;let a=new Audio(St);a.oncanplaythrough=()=>{let e=a.play();e&&e.catch(i=>{i.name==="NotAllowedError"||i.name})}},ht=(t,a,e,i)=>{let s,n,r=a.width,c=a.height,h=r/c,l=parseInt(getComputedStyle(a).width),o=parseInt(getComputedStyle(a).height),v=l/o;e.innerHTML="",h>v?(s=l/r,n=l/h/c):(n=o/c,s=o*h/r);for(let m=0;m<t.length;m++){let u=t[m],E=document.createElement("canvas"),x=E.getContext("2d",{willReadFrequently:!0}),_={},T=[],g=[],A=0,f=0,S=i.length===2&&i[1]?.font?.replace(/[^0-9]/g,"");S&&/[0-9]/g.test(S)&&(A=parseFloat(S),f=(s||1)*A,Number.isNaN(f)&&(f=A));let b=u.points;for(let p=0;p<b.length;p++){let U=b?.[p]?.x??0,y=b?.[p]?.y??0;_[`x${p+1}`]=U,_[`y${p+1}`]=y,T.push(U),g.push(y)}let Q=Math.max(...T),D=Math.min(...T),W=Math.max(...g),O=Math.min(...g);E.setAttribute("class","qrcode-polygon"),h>v?(E.style.top=O*n+(o-l/h)*.5+"px",E.style.left=D*s+"px",E.width=(Q-D)*s,E.height=(W-O)*s):(E.style.top=O*n+"px",E.style.left=D*s+(l-o*h)*.5+"px",E.width=(Q-D)*n,E.height=(W-O)*n);for(let p in i[0])x[p]=i[0][p];let G=[];for(let p=0;p<T.length;p++)G.push((_[`x${p+1}`]-D)*n),G.push((_[`y${p+1}`]-O)*s);let R=G.slice(0);for(x.beginPath(),x.moveTo(R.shift(),R.shift());R.length;)x.lineTo(R.shift(),R.shift());if(x.closePath(),x.fill(),x.stroke(),A){let p=document.createElement("div");p.setAttribute("class","qrcode-tooltip-temp"),p.innerText=u.value,p.style.maxWidth=(r>window.innerWidth?window.innerWidth*.9:r)+"px",p.style.borderRadius=`clamp(1px, ${s*A-10}px, 3px)`,p.style.paddingBlock=`clamp(1px, ${s*A-10}px, 3px)`,p.style.paddingInline=`clamp(2.5px, ${s*A-6}px, 10px)`;let U=`<svg xmlns="http://www.w3.org/2000/svg" width="${f}" height="${f}" viewBox="0 0 512 512"><rect x="128" y="128" width="336" height="336" rx="57" ry="57"></rect><path d="M383.5,128l.5-24a56.16,56.16,0,0,0-56-56H112a64.19,64.19,0,0,0-64,64V328a56.16,56.16,0,0,0,56,56h24"></path></svg>`,y=new DOMParser().parseFromString(U,"application/xml"),Y=p.ownerDocument.importNode(y.documentElement,!0);Y.style.marginLeft=`clamp(1px, ${s*A-10}px, 3px)`,p.appendChild(Y),Y.addEventListener("click",()=>window.navigator.clipboard.writeText(u.value)),p.addEventListener("click",()=>window.navigator.clipboard.writeText(u.value));let N=document.createElement("div");N.setAttribute("class","qrcode-tooltip"),N.appendChild(p),n=o/c,s=o*h/r,N.style.fontSize=s*A+"px",N.style.top=O*n+"px",N.style.left=D*s+(l-o*h)*.5+"px",N.style.width=(Q-D)*n+"px",N.style.height=(W-O)*n+"px";let I=document.createElement("span");I.innerText=u.value,I.style.top=O*n+-20*n+"px",I.style.left=D*s+(l-o*h)*.5+"px";let vt=i[1]?.font?.split(" ")?.[1];I.style.fontFamily=vt,I.style.fontSize=s*A+"px",I.style.color=i?.[1]?.fillStyle,e?.appendChild(N),e?.appendChild(I)}e?.appendChild(E)}},Ot=(t,a,e)=>{let i=a.getContext("2d",{willReadFrequently:!0});for(let s=0;s<t.length;s++){let n=t[s],r={},c=[],h=[],l=0,v=e[1]?.font?.split(" ")?.[0]?.replace(/[^0-9]/g,"");v&&/[0-9]/g.test(v)&&(l=parseFloat(v));let m=n.points;for(let g=0;g<m.length;g++){let A=m?.[g]?.x??0,f=m?.[g]?.y??0;r[`x${g+1}`]=A,r[`y${g+1}`]=f,c.push(A),h.push(f)}let u=Math.min(...c),E=Math.min(...h),x=()=>{for(let f in e[0])i[f]=e[0][f];let g=[];for(let f=0;f<c.length;f++)g.push(r[`x${f+1}`]),g.push(r[`y${f+1}`]);let A=g.slice(0);for(i.beginPath(),i.moveTo(A.shift(),A.shift());A.length;)i.lineTo(A.shift(),A.shift());i.closePath(),i.fill(),i.stroke()},_=document.createElement("canvas"),T=()=>{let g=e[1]?.font?.split(" ")?.[1];_.height=a.height,_.width=a.width;let A=_.getContext("2d",{willReadFrequently:!0});A.font=l+"px "+g;for(let f in e[1])A[f]=e[1][f];Ct(A,n.value,u,E-5)};x(),T(),i.drawImage(_,0,0)}},Nt=(t,a)=>{let e=a?.decode??w.decode,i=a?.canvasStyles?.length===2?a?.canvasStyles:[et,st],s=a?.isBeep??w.isBeep,n=a?.isMasked??w.isMasked,r=a?.unScan??w.unScan,c=a?.symbolType??w.symbolType;return new Promise((h,l)=>{let o=new FileReader;o.onload=()=>{let v={name:t.name,file:t,url:URL.createObjectURL(t)},m=new Image;m.setAttribute("crossOrigin","anonymous"),m.onload=()=>V(null,null,function*(){let u=document.createElement("canvas");u.width=m.naturalWidth||m.width,u.height=m.naturalHeight||m.height;let E=u.getContext("2d");E.drawImage(m,0,0,u.width,u.height);let x=E.getImageData(0,0,u.width,u.height);if(r)return h(Object.assign({},v,{data:[],canvas:u}));if(H()){let _=yield zbarWasm.scanImageData(x);if(c?.some(g=>g.toString()!==C.ScannerQRCode_NONE.toString())&&(_=_.filter(g=>{let A=g.typeName.replace("ZBAR","ScannerQRCode");return c?.some(S=>S.toString()===C[A].toString())})),_?.length){_.forEach(S=>S.value=S.decode(e?.toLocaleLowerCase())),n&&Ot(_,u,i);let g=yield mt(u),A=URL.createObjectURL(g);h(Object.assign({},v,{data:_,url:A,canvas:u,file:((S,b)=>new File([S],b,{lastModified:new Date().getTime(),type:S.type}))(g,v.name)})),tt(s)}else h(Object.assign({},v,{data:_,canvas:u}))}}),m.src=v.url},o.onerror=v=>l(v),o.readAsDataURL(t)})},mt=(t,a)=>new Promise((e,i)=>t.toBlob(s=>e(s),a)),Tt=(t,a)=>new File([t],a,{lastModified:new Date().getTime(),type:t.type}),It=(t=[],a,e,i,s=new F)=>(bt(t,e,i).then(n=>{Promise.all(Object.assign([],n).map(r=>Nt(r,a))).then(r=>{d(s,r)}).catch(r=>d(s,null,r))}),s),Ct=(t,a,e,i)=>{let s=t.measureText("M").width*1.2,n=a.split(`
`);for(var r=0;r<n.length;++r)t.fillText(n[r],e,i),t.strokeText(n[r],e,i),i+=s},bt=(t=[],a=100,e=100)=>{if(t.length&&(a<100||e<100)){let i=[];return new Promise((s,n)=>{for(let r of t){let c=new Image,h=new FileReader;h.onload=function(l){c.onload=function(){let o=document.createElement("canvas"),v=o.getContext("2d"),m=Math.round(c.width*(a/100)),u=Math.round(c.height*(a/100));o.width=m,o.height=u,v.drawImage(c,0,0,m,u),o.toBlob(E=>{let x=new File([E],r.name,{type:r.type});i.push(x),t.length===i.length&&s(i)},r.type,e/100)},c.src=l.target.result},h.onerror=l=>n(l),h.readAsDataURL(r)}})}else return Promise.resolve(t)},At=t=>{Object.assign([],t.childNodes).forEach(a=>t.removeChild(a))},Rt=t=>{t.getContext("2d",{willReadFrequently:!0}).clearRect(0,0,t.width,t.height)},J=(t,a)=>{t.style.width=a.offsetWidth+"px",t.style.height=a.offsetHeight+"px"},ut=(t=300)=>{t&&Vt()&&window?.navigator?.vibrate(t)},Vt=()=>{let t=navigator.userAgent||navigator.vendor||window.opera,a=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,e=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i,i=/^((?!chrome|android).)*safari/i;return!!(a.test(t)||e.test(t.substr(0,4)))&&!i.test(t)};var it=(t="",a=new F,e)=>{let i=0,s=(n=!1)=>{let r=l=>{let o;try{let v=()=>{l&&zbarWasm.setModuleArgs({locateFile:(u,E)=>t||E+u}),setTimeout(()=>d(a,!0))},m=()=>{clearTimeout(o),H()?v():o=setTimeout(()=>m())};setTimeout(()=>m()),setTimeout(()=>clearTimeout(o),3e3)}catch{clearTimeout(o)}},c=document.querySelectorAll(`script[src="${M}"]`),h=document.querySelectorAll(`script[src="${Ft}"]`);if(c.length||h.length)r(!1);else{let l=document.querySelectorAll(`script[src="${k}"]`);if(l.length===1)r(!1);else if(l.forEach(o=>o.remove()),e){let o=e.createElement("script");e.setAttribute(o,"src",n?M:k),e.setAttribute(o,"type","text/javascript"),e.setAttribute(o,"async",""),e.appendChild(document.head,o),o.onload=()=>r(!0),o.onerror=()=>{i<2?(document.head.removeChild(o),s(!0)):d(a,!1,"Could not load script "+n?M:k)},i+=1}else{let o=document.createElement("script");o.setAttribute("src",n?M:k),o.setAttribute("type","text/javascript"),o.setAttribute("async",""),document.head.appendChild(o),o.onload=()=>r(!0),o.onerror=()=>{i<2?(document.head.removeChild(o),s(!0)):d(a,!1,"Could not load script "+n?M:k)},i+=1}}};return s(),a},gt=(()=>{class t{renderer;elementRef;video;canvas;resultsPanel;event=new ot;config=w;src=w.src;fps=w.fps;vibrate=w.vibrate;decode=w.decode;isBeep=w.isBeep;isMasked=w.isMasked;unScan=w.unScan;loadWasmUrl=w.loadWasmUrl;symbolType=w.symbolType;constraints=w.constraints;canvasStyles=[et,st];isStart=!1;isPause=!1;isLoading=!1;isTorch=!1;data=new $([]);devices=new $([]);deviceIndexActive=0;rAF_ID;dataForResize=[];ready=new F;STATUS={startON:()=>this.isStart=!0,pauseON:()=>this.isPause=!0,loadingON:()=>this.isLoading=!0,startOFF:()=>this.isStart=!1,pauseOFF:()=>this.isPause=!1,loadingOFF:()=>this.isLoading=!1,torchOFF:()=>this.isTorch=!1};constructor(e,i){this.renderer=e,this.elementRef=i}ngOnInit(){this.overrideConfig(),it(this.loadWasmUrl,this.ready,this.renderer).subscribe(()=>{this.src&&this.loadImage(this.src),this.resize()})}start(e){let i=new F;return this.isStart?d(i,!1):this.safariWebRTC(i,e),i}stop(){this.STATUS.pauseOFF(),this.STATUS.startOFF(),this.STATUS.torchOFF(),this.STATUS.loadingOFF();let e=new F;try{clearTimeout(this.rAF_ID),this.video.nativeElement.srcObject.getTracks().forEach(i=>{i.stop(),d(e,!0)}),this.dataForResize=[],Rt(this.canvas.nativeElement),At(this.resultsPanel.nativeElement)}catch(i){d(e,!1,i)}return e}play(){let e=new F;return this.isPause?(this.video.nativeElement.play(),this.STATUS.pauseOFF(),this.requestAnimationFrame(),d(e,!0)):d(e,!1),e}pause(){let e=new F;return this.isStart?(clearTimeout(this.rAF_ID),this.video.nativeElement.pause(),this.STATUS.pauseON(),d(e,!0)):d(e,!1),e}playDevice(e,i=new F){let s=this.getConstraints(),n=this.isStart&&s?s.deviceId!==e:!0;switch(!0){case(e==="null"||e==="undefined"||!e):stop(),this.stop(),d(i,!1);break;case(e&&n):stop(),this.stop(),this.STATUS.loadingON(),this.deviceIndexActive=this.devices.value.findIndex(c=>c.deviceId===e);let r=z(P({},this.constraints),{audio:!1,video:P({deviceId:e},this.constraints.video)});navigator.mediaDevices.getUserMedia(r).then(c=>{this.video.nativeElement.srcObject=c,this.video.nativeElement.onloadedmetadata=()=>{this.video.nativeElement.play(),this.requestAnimationFrame(),d(i,!0),this.STATUS.startON(),this.STATUS.loadingOFF()}}).catch(c=>{this.eventEmit(!1),d(i,!1,c),this.STATUS.startOFF(),this.STATUS.loadingOFF()});break;default:d(i,!1),this.STATUS.loadingOFF();break}return i}loadImage(e){let i=new F;this.STATUS.startOFF(),this.STATUS.loadingON();let s=new Image;return s.setAttribute("crossOrigin","anonymous"),s.onload=()=>{H()&&this.drawImage(s,n=>{d(i,n),this.STATUS.startOFF(),this.STATUS.loadingOFF()})},s.src=e,i}torcher(){let e=this.applyConstraints({advanced:[{torch:this.isTorch}]});return e.subscribe(()=>!1,()=>this.isTorch=!this.isTorch),e}applyConstraints(e,i=0){let s=new F;if(this.isStart){let n=this.video.nativeElement.srcObject;if(i!==null||i!==void 0||!Number.isNaN(i)){let r=n.getVideoTracks()[i];new window.ImageCapture(r).getPhotoCapabilities().then(()=>V(this,null,function*(){yield r.applyConstraints(e),J(this.video.nativeElement,this.canvas.nativeElement),d(s,!0)})).catch(h=>{switch(h?.name){case"NotFoundError":case"DevicesNotFoundError":d(s,!1,"Required track is missing");break;case"NotReadableError":case"TrackStartError":d(s,!1,"Webcam or mic are already in use");break;case"OverconstrainedError":case"ConstraintNotSatisfiedError":d(s,!1,"Constraints can not be satisfied by avb. devices");break;case"NotAllowedError":case"PermissionDeniedError":d(s,!1,"Permission denied in browser");break;case"TypeError":d(s,!1,"Empty constraints object");break;default:d(s,!1,h);break}})}else d(s,!1,"Please check again deviceIndex")}else d(s,!1,"Please start the scanner");return s}getConstraints(e=0){return this.video.nativeElement.srcObject?.getVideoTracks()[e]?.getConstraints()}download(e=`ngx_scanner_qrcode_${Date.now()}.png`,i,s){let n=new F;return V(this,null,function*(){let r=yield mt(this.canvas.nativeElement),c=Tt(r,e);It([c],this.config,i,s,n).subscribe(h=>{h.forEach(l=>{if(l?.data?.length){let o=document.createElement("a");o.href=l.url,o.download=l.name,o.click(),o.remove()}})})}),n}resize(){window.addEventListener("resize",()=>{ht(this.dataForResize,this.canvas.nativeElement,this.resultsPanel.nativeElement,this.canvasStyles),J(this.video.nativeElement,this.canvas.nativeElement)})}overrideConfig(){"src"in this.config&&(this.src=this.config.src),"fps"in this.config&&(this.fps=this.config.fps),"vibrate"in this.config&&(this.vibrate=this.config.vibrate),"decode"in this.config&&(this.decode=this.config.decode),"isBeep"in this.config&&(this.isBeep=this.config.isBeep),"isMasked"in this.config&&(this.isMasked=this.config.isMasked),"unScan"in this.config&&(this.unScan=this.config.unScan),"loadWasmUrl"in this.config&&(this.loadWasmUrl=this.config.loadWasmUrl),"symbolType"in this.config&&(this.symbolType=this.config.symbolType),"constraints"in this.config&&(this.constraints=Dt("constraints",this.config,pt)),"canvasStyles"in this.config&&this.config?.canvasStyles?.length===2&&(this.canvasStyles=this.config.canvasStyles)}safariWebRTC(e,i){this.STATUS.startOFF(),this.STATUS.loadingON(),navigator.mediaDevices.getUserMedia(this.constraints).then(s=>{s.getTracks().forEach(n=>n.stop()),this.loadAllDevices(e,i)}).catch(s=>{d(e,!1,s),this.STATUS.startOFF(),this.STATUS.loadingOFF()})}loadAllDevices(e,i){navigator.mediaDevices.enumerateDevices().then(s=>{let n=s.filter(r=>r.kind=="videoinput");this.devices.next(n),n?.length>0?(d(e,n),i?i(n):this.playDevice(n[0].deviceId)):(d(e,!1,"No camera detected."),this.STATUS.startOFF(),this.STATUS.loadingOFF())}).catch(s=>{d(e,!1,s),this.STATUS.startOFF(),this.STATUS.loadingOFF()})}drawImage(e,i=()=>{}){return V(this,null,function*(){let s=this.canvas.nativeElement,n=s.getContext("2d",{willReadFrequently:!0});e instanceof HTMLImageElement&&(s.width=e.naturalWidth,s.height=e.naturalHeight,e.style.visibility="",this.video.nativeElement.style.visibility="hidden",this.renderer.setStyle(this.elementRef.nativeElement,"width",s.width+"px"),this.renderer.setStyle(this.elementRef.nativeElement,"maxWidth","100%"),this.renderer.setStyle(this.elementRef.nativeElement,"display","inline-block")),e instanceof HTMLVideoElement&&(s.width=e.videoWidth,s.height=e.videoHeight,e.style.visibility="",this.canvas.nativeElement.style.visibility="hidden"),J(this.video.nativeElement,s),n.clearRect(0,0,s.width,s.height),n.drawImage(e,0,0,s.width,s.height);let r=n.getImageData(0,0,s.width,s.height);if(this.unScan)return Promise.resolve();let c=yield zbarWasm.scanImageData(r);if(this.symbolType?.some(l=>l.toString()!==C.ScannerQRCode_NONE.toString())&&(c=c.filter(l=>{let o=l.typeName.replace("ZBAR","ScannerQRCode");return this.symbolType?.some(m=>m.toString()===C[o].toString())})),c?.length){c.forEach(o=>o.value=o.decode(this.decode?.toLocaleLowerCase())),this.isMasked&&ht(c,Object.freeze(this.canvas.nativeElement),this.resultsPanel.nativeElement,this.canvasStyles);let l=()=>{this.eventEmit(c),this.dataForResize=c};e instanceof HTMLImageElement&&(i(!0),l(),ut(this.vibrate),tt(this.isBeep)),e instanceof HTMLVideoElement&&(l(),ut(this.vibrate),tt(this.isBeep))}else i(!1),At(this.resultsPanel.nativeElement),this.dataForResize=[]})}eventEmit(e=!1){e!==!1&&this.data.next(e||[]),e!==!1&&this.event.emit(e||[])}requestAnimationFrame(e=100){try{clearTimeout(this.rAF_ID),this.rAF_ID=setTimeout(()=>{this.video.nativeElement.readyState===this.video.nativeElement.HAVE_ENOUGH_DATA&&(e=0,H()&&this.drawImage(this.video.nativeElement),this.isStart&&!this.isPause&&this.requestAnimationFrame(e))},e||this.fps)}catch{clearTimeout(this.rAF_ID)}}get isReady(){return this.ready}ngOnDestroy(){this.pause()}static \u0275fac=function(i){return new(i||t)(X(at),X(nt))};static \u0275cmp=L({type:t,selectors:[["ngx-scanner-qrcode"]],viewQuery:function(i,s){if(i&1&&(q(_t,5),q(wt,5),q(xt,5)),i&2){let n;B(n=j())&&(s.video=n.first),B(n=j())&&(s.canvas=n.first),B(n=j())&&(s.resultsPanel=n.first)}},hostAttrs:[1,"ngx-scanner-qrcode"],inputs:{config:"config",src:"src",fps:"fps",vibrate:"vibrate",decode:"decode",isBeep:"isBeep",isMasked:"isMasked",unScan:"unScan",loadWasmUrl:"loadWasmUrl",symbolType:"symbolType",constraints:"constraints",canvasStyles:"canvasStyles"},outputs:{event:"event"},exportAs:["scanner"],decls:6,vars:0,consts:[["resultsPanel",""],["canvas",""],["video",""],[1,"origin-overlay"],[1,"origin-canvas"],["playsinline","",1,"origin-video"]],template:function(i,s){i&1&&rt(0,"div",3,0)(2,"canvas",4,1)(4,"video",5,2)},styles:[`.ngx-scanner-qrcode{display:block;position:relative}.origin-overlay{width:100%;position:absolute}.origin-overlay span{z-index:2;text-align:left;position:absolute}.origin-overlay .qrcode-polygon{z-index:1;position:absolute}.origin-canvas{width:100%;position:absolute}.origin-video{width:100%;background-color:#262626}.qrcode-tooltip{z-index:3;position:absolute}.qrcode-tooltip:hover .qrcode-tooltip-temp{display:block;position:absolute;cursor:copy}.qrcode-tooltip:hover .qrcode-tooltip-temp:active{color:#afafaf}.qrcode-tooltip .qrcode-tooltip-temp{bottom:0;left:50%;color:#fff;text-align:left;display:none;width:max-content;word-wrap:break-word;transform:translate(-50%);transform-style:preserve-3d;background-color:#000000d0;box-shadow:1px 1px 20px #000000e0}.qrcode-tooltip .qrcode-tooltip-temp svg{cursor:pointer}.qrcode-tooltip .qrcode-tooltip-temp svg rect{fill:none;stroke:#fff;stroke-linejoin:round;stroke-width:32px}.qrcode-tooltip .qrcode-tooltip-temp svg path{fill:none;stroke:#fff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px}.qrcode-tooltip .qrcode-tooltip-temp svg:active rect{stroke:#afafaf}.qrcode-tooltip .qrcode-tooltip-temp svg:active path{stroke:#afafaf}
`],encapsulation:2})}return t})();var ft=class t{scannedData=null;constructor(){it("assets/wasm/ngx-scanner-qrcode.wasm").subscribe()}onScan(a){this.scannedData=a}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=L({type:t,selectors:[["app-qr-reader"]],decls:4,vars:0,consts:[[2,"text-align","center","margin-top","20px"],[2,"width","100%","height","300px",3,"scanSuccess"]],template:function(e,i){e&1&&(K(0,"div",0)(1,"h2"),lt(2,"QR Code Reader New"),Z()(),K(3,"ngx-scanner-qrcode",1),ct("scanSuccess",function(n){return i.onScan(n)}),Z())},dependencies:[dt,gt],encapsulation:2})};export{ft as QrReader};
